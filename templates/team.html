{% extends 'base.html' %}

{% block content %}
<div class="max-w-2xl mx-auto space-y-8">
    <div class="glass p-8 rounded-xl text-center space-y-6">
        <h1 class="text-4xl font-bold gradient-text">{{ team['name'] }}</h1>

        <div class="grid grid-cols-3 gap-4 border-y border-slate-700 py-6">
            <div>
                <div class="text-xs text-slate-400 uppercase font-bold">Elo Rating</div>
                <div class="text-2xl font-mono text-yellow-400">{{ team['elo'] }}</div>
            </div>
            <div>
                <div class="text-xs text-slate-400 uppercase font-bold">Win Rate</div>
                <div class="text-2xl font-mono text-pink-400">
                    {% if team['plays'] > 0 %}
                    {{ (team['wins'] / team['plays'] * 100)|round|int }}%
                    {% else %}
                    -
                    {% endif %}
                </div>
            </div>
            <div>
                <div class="text-xs text-slate-400 uppercase font-bold">Matches</div>
                <div class="text-2xl font-mono text-violet-400">{{ team['plays'] }}</div>
            </div>
        </div>

        <div class="text-left space-y-4">
            <h3 class="font-bold text-lg">About Team</h3>
            {% if is_own_profile %}
            <form method="post" class="space-y-4">
                <textarea name="description" rows="4"
                    class="w-full bg-slate-900/50 border border-slate-700 rounded-lg p-4 focus:outline-none focus:border-pink-500 transition"
                    placeholder="Tell us about your team...">{{ team['description'] or '' }}</textarea>
                <div class="text-right">
                    <button type="submit"
                        class="px-6 py-2 rounded-lg bg-slate-700 hover:bg-slate-600 transition font-bold text-sm">
                        Save Description
                    </button>
                </div>
            </form>
            {% else %}
            <div class="bg-slate-800/30 p-6 rounded-lg text-slate-300 italic">
                {{ team['description'] or 'No description provided.' }}
            </div>
            {% endif %}
        </div>

        <div class="border-t border-slate-700 pt-6">
            <h3 class="font-bold text-lg mb-4 text-left">Elo History</h3>
            <div class="h-64 w-full bg-slate-900/30 rounded-xl p-4">
                <canvas id="eloChart"></canvas>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const ctx = document.getElementById('eloChart').getContext('2d');
    const eloHistory = {{ elo_history| tojson }};

    // Handle the case where we only have the starting point
    const labels = eloHistory.length > 0 ? eloHistory.map(h => {
        if (h.date === 'Start') return 'Start';
        return new Date(h.date).toLocaleDateString();
    }) : ['Start'];

    const data = eloHistory.length > 0 ? eloHistory.map(h => h.elo) : [1000];

    new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                label: 'Elo Rating',
                data: data,
                borderColor: '#ec4899',
                backgroundColor: 'rgba(236, 72, 153, 0.1)',
                borderWidth: 2,
                tension: 0.4,
                fill: true
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                }
            },
            scales: {
                y: {
                    grid: {
                        color: 'rgba(255, 255, 255, 0.1)'
                    },
                    ticks: {
                        color: '#94a3b8'
                    }
                },
                x: {
                    grid: {
                        display: false
                    },
                    ticks: {
                        color: '#94a3b8'
                    }
                }
            }
        }
    });
</script>
{% endblock %}